<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.personPool">
    <!--表名 -->
    <sql id="table">
        TC_PERSON_POOL
    </sql>


    <!-- 字段 -->
    <sql id="colum">
        IDCARD_TYPE,
        IDCARD_NO,
        NAME,
        NATION,
        SEX,
        BIRTH_DATE,
        ADDRESS,
        PHONE,
        PHOTO,
        OPER_ID_CARD_NO,
        STATE,
        BIZ_FLOW_NO,
        EMAIL,
        PERSON_TYPE,
        CARD_START_DATE,
        CARD_END_DATE,
        POST,
        POLITICAL_STATUS,
        EDUCATION_DEGREE
    </sql>

    <insert id="addPerSonInfo"  useGeneratedKeys="true" keyProperty="id" parameterType="PersonPool">
        INSERT INTO
        <include refid="table"></include>
        (
        <include refid="colum"></include>
        )
        values (
        #{idcardType},
        #{idcardNo},
        #{name},
        #{nation},
        #{sex},
        #{birthDate},
        #{address},
        #{phone},
        #{photo},
        #{operIdCardNo},
        #{state},
        #{bizFlowNo},
        #{email},
        #{personType},
        #{cardstartdate},
        #{cardenddate},
        #{post},
        #{politicalStatus},
        #{educationDegree}
        )
    </insert>
    
    <select id="getPersonByBizId" parameterType="String" resultType="PersonPool">
    	SELECT * FROM TC_PERSON_POOL WHERE BIZ_FLOW_NO = #{_parameter} and phone is not null and phone &lt;&gt; '' and ADDRESS is not null and ADDRESS &lt;&gt; ''
    </select>
    
    <select id="isExits" parameterType="PersonPool" resultType="PersonPool">
    	SELECT * FROM TC_PERSON_POOL WHERE BIZ_FLOW_NO = #{bizFlowNo} AND IDCARD_NO = #{idcardNo}
    </select>
    
	<update id="clearPerson" parameterType="java.lang.String">
		UPDATE TC_PERSON_POOL SET PHONE = '' WHERE ID = #{_parameter}
	</update>

    <update id="deletePerson" parameterType="java.lang.String">
		delete from TC_PERSON_POOL WHERE ID = #{_parameter}
	</update>
	
	<update id="addIdCardInfo"  parameterType="PersonPool">
		UPDATE TC_PERSON_POOL SET 
		        IDCARD_TYPE =  #{idcardType},
		        NAME =  #{name},
		        NATION = #{nation},
		        SEX = #{sex},
		        BIRTH_DATE = #{birthDate},
		        ADDRESS = #{address},
		        PHONE = #{phone},
		        PHOTO = #{photo},
		        OPER_ID_CARD_NO = #{operIdCardNo},
		        STATE = #{state},
		        EMAIL =  #{email},
		        PERSON_TYPE =  #{personType},
		        CARD_START_DATE = #{cardstartdate},
		        CARD_END_DATE = #{cardenddate},
				POST = #{post},
				POLITICAL_STATUS = #{politicalStatus},
				EDUCATION_DEGREE = #{educationDegree}
		   where BIZ_FLOW_NO = #{bizFlowNo} AND IDCARD_NO = #{idcardNo}
	</update>
	

	<select id="searchPhoneNum" parameterType="PersonPool" resultType="PersonPool">
		select t.idcard_no,t.phone from TC_PERSON_POOL t where t.biz_flow_no=#{bizFlowNo}  and t.name=#{name}
	</select>

	<delete id="delPersonByBizNo" parameterType="java.lang.String">
		DELETE FROM TC_PERSON_POOL WHERE BIZ_FLOW_NO = #{_parameter}
	</delete>
	
	<update id="updatePersonInfo" parameterType="com.ctd.bank.business.model.PeopleDutyModel" >
		UPDATE TC_PERSON_POOL SET 
		        IDCARD_TYPE =  #{idcardType},
		        NAME =  #{name},
		        NATION = #{nation},
		        SEX = #{sex},
		        BIRTH_DATE = #{birthDate},
		        ADDRESS = #{address},
		        PHONE = #{phone},
		        PHOTO = #{photo},
		        CARD_START_DATE = #{cardstartdate},
		        CARD_END_DATE = #{cardenddate},
		        POST = #{post},
				POLITICAL_STATUS = #{politicalStatus},
				EDUCATION_DEGREE = #{educationDegree}
		   where BIZ_FLOW_NO = #{bizFlowNo} AND IDCARD_NO = #{idcardNo}
	</update>
	
	
	<select id="searchPhoneName" parameterType="PersonPool" resultType="PersonPool">
		select t.idcard_no,t.phone,t.name from TC_PERSON_POOL t where t.biz_flow_no=#{bizFlowNo}  and t.id=#{id}
	</select>
	

    <select id="isExitsPerson" parameterType="PersonPool" resultType="PersonPool">
    	SELECT * FROM TC_PERSON_POOL WHERE ID = #{id}
    </select>
    
    <select id="getPersonByBizIdAndDuty" parameterType="String" resultType="PersonPool">
		SELECT TP.* FROM TC_DUTY T LEFT JOIN TC_PERSON_POOL TP ON T.PERSON_ID = TP.ID WHERE T.DUTY = '08' AND T.BIZ_FLOW_NO = #{_parameter}
    </select>
    
    <select id="getBsqr" parameterType="String" resultType="com.ctd.bank.business.model.PeopleDutyModel">
        SELECT TP.* FROM TC_DUTY T LEFT JOIN TC_PERSON_POOL TP ON T.PERSON_ID = TP.ID WHERE T.DUTY = '09'  AND T.BIZ_FLOW_NO = #{_parameter}
    </select>
    
     <select id="getBsqrByiDcard" parameterType="PersonPool" resultType="com.ctd.bank.business.model.PeopleDutyModel">
        SELECT TP.* FROM TC_DUTY T LEFT JOIN TC_PERSON_POOL TP ON T.PERSON_ID = TP.ID WHERE T.DUTY = '09'  AND T.BIZ_FLOW_NO = #{bizFlowNo} and TP.IDCARD_NO = #{idcardNo} 
    </select>
    
    <update id="updateBsqr" parameterType="PersonPool" >
        UPDATE TC_PERSON_POOL SET 
                NAME =  #{name},
                IDCARD_NO = #{idcardNo},
                PHONE = #{phone}
           where id = #{id}
    </update>

    <update id="updateJbrPhone" parameterType="PersonPool" >
        UPDATE TC_PERSON_POOL SET
        PHONE = #{phone}
        where id = #{id}
    </update>
    
</mapper>